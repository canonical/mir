name: TICS

on:
#  push:
#    branches:
#    - main
  schedule:
  # 5:04 on a Wednesday
  - cron: 5 4 * * 3
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}

jobs:
  Prepare:
    uses: ./.github/workflows/tics-run.yml
    secrets: inherit
    with:
      calc-matrix: |
        ["PREPARE,CHANGEDFILES,BUILDRELATIONS,INCLUDERELATIONS,LOC"]

  Run:
    needs:
    - Prepare
    uses: ./.github/workflows/tics-run.yml
    secrets: inherit
    with:
      calc-matrix: |
        [
          "CODINGSTANDARD,COMPILERWARNING,FANOUT,CYCLOMATICCOMPLEXITY",
          "PREPARE,ABSTRACTINTERPRETATION,SECURITY",
          "UNITTESTCOVERAGE,SYSTEMTESTCOVERAGE,INTEGRATIONTESTCOVERAGE,TOTALTESTCOVERAGE"
        ]
      parallel: true
      timeout-minutes: 240

  Finalize:
    if: ${{ always() }}
    needs:
    - Prepare
    - Run
    uses: ./.github/workflows/tics-run.yml
    secrets: inherit
    with:
      calc-matrix: |
        ["FINALIZE,POSTANA"]
      parallel: true
